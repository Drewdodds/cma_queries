with bc_data as (select GTIN,
                        min(price) as competitor_price
                from ANALYTICS.FWS_STAGING.BLACKCURVE_RECENT_COMPETITOR_PRICES
                where GTIN in ('00054568591203',
'00054568593887'
'00054568552167',
'00054568554840',
'00054568555618',
'00054568591104',
'00054568555748',
'00054568565785',
'00054568553782',
'00182682386815',
'00752324313785',
'00054568595485',
'00054568597038',
'00054568591661',
'00163120782499',
'00220215041036',
'00046850183180',
'00054568200099',
'00756806500434',
'00789957313493',
'00054568591609',
'00054568591227',
'00046850183265',
'00752324006656',
'00054568595171',
'00054568553799',
'00054568553607',
'00054568552655',
'00046843635764',
'00046870182910',
'00054568591579',
'00054568551085',
'00078433210495',
'00054568592934',
'00054568554666',
'00054568549396',
'00054568591142',
'00752324313754',
'00799705703285',
'00054568534163',
'00054568595157',
'00054568560148',
'00054568595461',
'00054568554284',
'00054568549587',
'00799705703513',
'00054568594792',
'00752324006625',
'00054568554345',
'00054568550743',
'00054568554369',
'00054568590961',
'00054568595164',
'00054568555373',
'00054568559630',
'00211711804911',
'00046843750733',
'00054568597137',
'00054568591548',
'00054568555151',
'00054568554277',
'00054568591210',
'00635510446286',
'00054568591241',
'00054568559616',
'00046850183258',
'00054568566348',
'00054568554123',
'00851905128203',
'00046843750870',
'00054568565792',
'00054568597526',
'00054568593832',
'00054568595027',
'00054568595478',
'00046850183302',
'00635510446408',
'00054568220219',
'00160921455294',
'00799705703810',
'00054568548566',
'00756806466105',
'00054568553324',
'00054568566720',
'00054568595690',
'00054568596758',
'00046850183401',
'00054568561343',
'00054568591654',
'00054568566355',
'00054568554871',
'00054568561282',
'00054568549600',
'00756806500403',
'00733353158523',
'00799932595875',
'00054568593825',
'00635510446330',
'00054568553768',
'00054568552204',
'00054568595041',
'00046850182954',
'00696395817363',
'00635510446323',
'00054568552020',
'00054568549402',
'00054568589811',
'00054568555366',
'00054568560179',
'00054568551108',
'00054568595065',
'00756806466112',
'00054568548665',
'00633841881837',
'00054568552044',
'00046850183432',
'00054568595133',
'00756806500021',
'00054568595225',
'00054568554673',
'00054568591197',
'00054568554659',
'00054568590930',
'00054568593856',
'00054568568519',
'00756806500052',
'00046843750740',
'00054568550903',
'00054568593870',
'00054568554390',
'00752324005598',
'00799932595905',
'00054568591173',
'00054568568601',
'00054568591555',
'00220215040961',
'00635510446354',
'00752324326396',
'00635510446316',
'00054568548443',
'00054568595140',
'00054568560155',
'00054568552228',
'00054568553744',
'00054568548498',
'00054568554642',
'00054568591210',
'00054568548535',
'00054568593733',
'00851905128036',
'00635510446347',
'00054568591586',
'00054568595218',
'00054568551061',
'00054568593849',
'00211712473918',
'00054568595201',
'00054568553317',
'00054568568571',
'00054568591180',
'00054568552143',
'00054568220165',
'00046850183425',
'00054568591647',
'00054568591616',
'00054568579409',
'00801039062133',
'00054568595492',
'00054568549747',
'00046843596430',
'00054568593863',
'00054568591159',
'00046843750825',
'00054568591111',
'00756806465177',
'00054568591531',
'00054568591913',
'00054568553805',
'00054568578822',
'00054568591234',
'00054568548573',
'00054568548689',
'00054568552846',
'00054568554444',
'00054568591562',
'00054568579201',
'00054568595195',
'00054568553416',
'00054568552822',
'00054568589217',
'00054568553775',
'00054568591135',
'00054568550712',
'00054568554109',
'00054568591593',
'00046850183395',
'00054568552334',
'00054568591166',
'00054568553294',
'00054568580061',
'00054568595188',
'00054568555410')
                and SITE_NAME  in (select competitor_price_name From raw.fws_tracked_competitors_pricing.competitor_tracked_list)
                group by 1)

select PRODUCT_ID,
       GP_SKU,
       lpad(upc::int, 14, 0) as salsify_gtin,
       round(VAR_COST,2) as cost,
       round(WEB_PRICE_MSRP,2) as list_price,
       round(WEB_PRICE / WEB_PRICE_MSRP,2) as FWS_discount,
       round(competitor_price / WEB_PRICE_MSRP, 2) as competitor_disc,
       round((WEB_PRICE - cost)/cost,2) as fws_margin,
       WEB_PRICE,
       competitor_price,
      round(WEB_PRICE - competitor_price,2) as price_difference,
       case when WEB_PRICE > competitor_price then 'above_market'
            when WEB_PRICE < competitor_price then 'below_market'
            else 'in range' end as comparison
from ANALYTICS.FWS_STAGING.STATIC_SALSIFY_BASIC as s1
join bc_data on bc_data.GTIN = lpad(s1.UPC::int, 14, 0)
where GP_SKU not like '%:%PK'
and WEB_PRICE_MSRP is not null
